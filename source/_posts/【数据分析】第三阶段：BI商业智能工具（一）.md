---
title: 【数据分析】第三阶段：BI商业智能工具（一）
date: 2021-05-16 11:02:43
tags:
- 数据分析
categories:
- 学习笔记
description: tableau数据可视化
---

# 前置知识

## tableau工作流程

1. 连接数据
2. 数据源预处理
3. 在工作表里开展可视化
4. 汇聚成一个仪表板
5. 还可以生成一个故事板
6. 汇报

## 连接数据

excel：excel只有一个sheet时，tableau会默认选择这个表；有多个sheet时需要主动选择哪个sheet作为数据源。

文本文件：.csv，.txt，以及没有后缀名的文本文件。字段名称位于第一行。

mySql：正版tableau才可以连接mySql。

直接复制数据源：在excel中复制数据，在tableau工作表区域粘贴。

## 数据预处理

规整数据：使用数据解释器，去除空行、标题等，智能识别数据表格;它可以检测并绕过标题、注释、页脚、空单 元格等内容，从而确定数据集中的实际字段和值。

数据格式设置：直接点击数据类型图标更改；在管理源数据中更改；在工作表中点击数据类型图标更改。

字段设置：列拆分（对有分隔符的列进行拆分），转置（多个同一纬度标题列，转化为一列），隐藏列，重命名。

## 数据连接

在数据拖拽区域，拖拽数据源，双击进入物理表，再拖拽第二个数据源，自动实现两个表连接，和mySql一样内连接，左连接，右链接，外连接（全集）

## 数据合并（混合关系）

数据连接是一个excel中几个sheet表，或者一个文本数据和几个文本数据连接。总之就是能在数据源区域同时展示出来就可以直接数据连接。

但是两个excel表的sheet不能同时在数据源区域同时展示，就不能直接使用数据连接。就需要用混合关系。效果和数据连接一样。

## 数据并集

列名相同，行合并。

就是和MySQL中的union一个作用，两个表的字段名都一样，把两个表的内容拼接成一张表。

文本文件：可以通过拖拽直接拼接。因为选择一个文本数据源，tableau会把这个目录下其他的文本数据源也展示出来。

excel：新建并集。因为选择一个excel数据源，tableau只能把这个excel中的全部sheet页展示出来，无法展示同目录下其他excel数据源。所以只能通过新建并集——通配符搜索其他excel数据源实现多个excel数据源的并集。

## 数据源管理

实时连接：数据量小的数据源可以使用，本地数据源发生更改，tableau也实时更改。

数据提取：数据量大的时候用，重新载入数据源。

# 基础概念

## 维度、度量、连续、离散、聚合、粒度

维度：简单理解为统计数据的角度、方式。比如统计某公司2020年每个月的毛利。时间（2020年每月）就是这个统计的维度。

度量：简单理解为所要统计的数据。比如统计某公司2020年每月的毛利。毛利就是度量，这个统计用毛利来度量公司的运营情况。

连续：在一定区间内可以任意取值的变量叫连续变量，其数值是连续不断的，相邻两个数值可作无限分割,即可取无限个数值。例如，生产零件的规格尺寸，人体测量的身高、体重、胸围等为连续变量,其数值只能用测量或计量的方法取得。

离散：离散变量指变量值可以按一定顺序一一列举，通常以整数位取值的变量。如职工人数、工厂数、机器台数等。有些性质上属于连续变量的现象也按整数取值，即可以把它们当做离散变量来看待。例如年龄、评定成绩等虽属连续变量，但一般按整数计算，按离散变量来处理。

聚合：简单理解为把多个数据通过计数、求和、求平均值、求最大值等方式变成一个值。指分散的聚集到一起。聚合的反义词是解聚。

粒度：简单理解为维度的详细程度，或数据被细分的程度。粒度就是同一维度下，数据统计的粗细程度。

在tableau中，度量默认是聚合的。

## 字段处理

基本的字段处理：

- 数据类型转换
- 维度、度量互转
- 字段排序
- 文件夹管理字段：多个字段意思差不多，可以把这些字段放在一个文件夹里。当字段很多的时候，便于快速查看。
- 设置数据格式
- 复制字段
- 日期类型转换
- 字段分层结构：比如有字段一级类目、二级类目...等，有层级关系的，可以建立分层结构管理这几个字段。

高级的字段处理：

- 拆分字段
- 创建计算字段：和excel中的计算字段一样。
- 创建分组：对字段中的值分组。比如地区这个维度中，有华北、东北、西南、西北、东南几个值，可以吧西南、东南分成一组，西北、东北分成一组。地区维度——右键——创建——组。分组的作用是为了把维度中不重要的分组在一起，凸显出重要的。
- 创建集：某个度量数据中有一些异常值，可以在画布中框选中异常值，右键创建集。这个集内就是异常值，集外就是度量中的其他数据。在创建的集上右键添加到筛选器，可以选择内/外，内就是集内的数据，就是异常值；外就是集外的数据，就是该度量除去异常值的其他所有数据。
- 创建数据桶：同mysql中ntile()函数，就是把数据按设定的步长从最小值到最大值分成几段。比如利润度量是-7978到10108，现在对利润创建数据桶，数据桶大小（步长）设为1000，利润数据桶就变成-8000，-7000，-6000，...，9000，10000。数据桶的作用是看数据的分布情况。

# 图标的组成

## 行和列

行和列可以放维度也可以放度量，没有限制，不必纠结。只需要看哪种方式呈现的效果更好。

## 视图

单元格：tableau中单元格的意思是视图中最小粒度的展现。

![](https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-17_19-51-28.jpg)

区：

![](https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-17_19-52-36.jpg)

排除和隐藏：排除是直接把这部分数据排除统计；隐藏是数据还在统计内，只是这部分数据统计结果不展示。

# 案例一

## 需求 制作2020年618期间跟盯销售情况仪表盘

### 展示内容设计思路

- 每日（昨日）销售情况
- 当日销售目标完成情况
- 同比去年增长情况
- 分品类构成
- 分单品销量排行

### 所需数据

- 2020年618期间每日销售数据
- 2020年618每日销售目标值
- 2019年618每日销售数据
- 2020年618每日sku级别销售数据

### 导入数据

2019年每日销售数据和2020年每日销售数据需要新建并集，合并成一张表导入。

### 制作视图

- 每日（昨日）销售情况

  计算字段——{fixed()} 函数，使用指定的维度计算聚合。

# B站tableau教学视频笔记

# 工作表

## 数据窗格

维度：一般都是字符串。维度代表着类别，类别大多数情况下是字符串。

度量：一般都是数值。度量代表着数值，它能进行比较大小、求和、求平均值等等。

## 页面、筛选器、标记

页面：用来做动图的。

筛选器：哪些数据你要留下或者删掉就用筛选器。

标记：

- 下拉框：你所做的图的类型是什么。自动、条形图、折线、饼图等等。
- 颜色：给图里各种东西做个颜色设置。
- 大小：比如柱形图柱子的宽度通过大小来设置，饼图圆的大小通过大小来设置。
- 标签：通常是用来显示对应的标签文字的。

## 列、行

列功能区：对应的就是横轴

行功能区：对应的就是纵轴。

# 条形图

条形图重点用来比较不同类别之间的大小。看谁大谁小谁高谁低。

## 统计各个地区酒店的数量

把地区维度拖到列功能区（也可以拖到行，看自己喜好）。

数据源里没有酒店数量这样的字段。但是tableau自己生成了一个度量，叫酒店数据（计数），他是对数据表中记录数进行计数。因为使用的数据表中，每一行数据就是一家酒店相应的信息，没有重复的。所以这个生成的字段就是酒店数量。

## 各地区酒店均价

地区维度拖到列。

价格度量拖到行。

发现价格有问题，值很大，因为tableau会对数值做聚合，默认是求和。在列-价格-上右键或点下拉三角-度量-选择平均值。此时就是各地区均价。

同样把价格度量拖到标签上，想在图上显示每个地区酒店均价的数值。这时默认也是求和，也需要选择成平均值。

## 各地区酒店价格等级堆积图

价格等级维度拖到颜色上。

## 酒店评分直方图

直方图用来看数据的分布情况。

创建直方图，不像条形图那样直接拖动创建。创建直方图前，需要先创建一个数据桶。

比如这里要看评分的直方图，就在评分度量上-右键-创建-数据桶。

有了数据桶之后，就能按照做条形图的方式来做直方图。

评分数据桶拖到列。

酒店数据（计数）拖到行。应为要统计的是每个评分下的酒店数量。

横轴的每个分布区间 是包含左边界，不包含右边界，并且默认只显示左边界的值。

# 数据前处理

## 拆分、自定义拆分

打开《中国电影网电影》excel数据。

在数据源页面，看到“电影名”字段，这个字段下的内容都是这样的格式：让子弹飞（2010）Let The Bullets Fly。电影名（年代）英文名。

在这个字段上-右键-拆分。拆分出来三个字段，分别是：让子弹飞，（2010），Let The Bullets Fly。

我可以用tableau来做一个自动拆分。如果你的数据是有一定的格式的，它们满足一个通用的结构，tableau能自动做拆分。

tableau的强项是可视化，数据预处理能力不强。有时候自动拆分达不到我们想要的效果，可以使用自定义拆分。

## 转换数据格式

在数据源页面，预览数据，每个字段上面都有图标标示该字段现在的数据格式，直接点击图标-选择其他数据格式即可。

比如这个数据源中，拆分出来的上映日期是字符串格式，我们需要转成日期格式。日期格式可以按照年、月、日等进行各种的处理，字符串不行。

# 绘制折线图

## 电影数量变化的折线图

 工作表

上映日期维度拖到列。因为统计的是电影数量随时间的变化。

sheet1（计数）度量拖到行。

时间上有个null，右键-排除。排除掉异常值。

y轴此时的标题是sheet1（计数），改标题名字，双击y轴-轴标题-改成电影数量。

想再电影数量最多的那个点添加个标记让他醒目一点，右键那个点-添加注释-标记-输入要现实的信息。

对这个标记更改样式，在标记上右键-设置格式-可以设置标记的边框、阴影，标记到点的线的样式。

## 电影票房变化折线图

上映日期维度拖到列。

累计票房（万）维度拖到行。

累计票房是维度，拖到行上发现，视图区是个表格，表格的横轴是年份，纵轴是累计票房。表格中没有内容。

这时因为累计票房是维度，他应该是度量才对。把累计票房从维度拖到度量里。在把累计票房度量拖到行上就正确了。

把累计票房度量拖到标签，让图上每个点显示当年票房总和数值。

这里发现，票房总和太大了显示的太长了，2,924,585，不美观。在标记中-累计票房比标签右键-设置格式-区-数字-数字（自定义）-小数位数0，单位选择千(k)。设置完后，显示的就是2,925k。

## 2015电影数量和票房变化折线图，放到一个图里

刚才电影数量和电影票房是在两个工作表里，现在想在一个工作表里作出这两个图，可以比较分析。

首先把上映时间拖到筛选器，选择年-下一步-勾选2015。

把上映时间维度拖到列。

把记录数度量拖到行，累计票房拖到行。

这时图上只有一个点。因为上映时间默认是最大的年级别，并且通过筛选现在只看2015年的。可以在列-上映时期-右键，选择季度、月、天级别。

双击y轴，改下标题，记录数改成电影数量。

这样就可以把电影数量和电影票房放在一张图里去比较了。

# 饼图

## 酒店价格等级饼图

价格等级拖到列。

酒店计数拖到行。

默认生成了一个条形图，点击右上角智能推荐，选择饼图。这里就生成了饼图。

拖动价格等级维度到标签，饼图上显示了每个饼代表的价格等级。

拖动酒店计数度量到标签，又显示了每个价格等级的酒店数量。

但我们做饼图想现实的是部分占整体的百分比情况。

在酒店计数标签上-右键-快速表计算-合计百分比。就显示了每一块占整体的百分比。

同样，现在显示的百分比有2为小数，我只想显示整数。在酒店计数标签上右键-设置格式-区-默认值-数字-选择百分比-小数位数0。

# 导出图像

刚才做好的饼图，可以导出成图片。

顶部菜单栏-选择工作表-导出-图像。

标题：就是图的标题，工作表的标题。

查看：必须，查看就是我们做的图。

说明：在图标下面可以添加些说明，在标记卡下面的空白区-右键-说明。

# 环形图

环形图就是在饼图基础上的变种。在饼图中间挖空，填充白色，就是一个环形图。

上一个饼图使用智能显示做的，做环形图不能用智能显示，tableau并不具备直接生成环形图的功能。要用标记卡中的下拉框选择图形来做。

做法：用两个饼图，一大一小，大的在外面，小的在里面，小的全都变成白色，背景色也是白色，整体就是一个环形图了。

## 酒店价格等级环形图

价格等级维度拖到颜色。每个色掰代表一个等级。

酒店计数度量拖到角度。每个色掰的大小表示这个等级的酒店数量。

下面开始制作环形图

拖一个酒店计数到行，再拖一个酒店计数到行。

两个酒店计数分别右键-快速表计算-排序。（有度量的话，也可以选择度量-最小值）。这里这么做的原因是：让两个图的度量方式、范围都保持一致，并且计数的排序或是最小值都是1，这样度量的坐标就都是0开始，0-1-2，并且两个度量值都是1，做到两个饼图完全镜像。

画布上出现两个饼图，坐标轴大小一样，饼图也一样。

在标记卡中，设置其中一个饼图大小大一点，另一个饼图大小小一点。

右键坐标轴-双轴。

在标记卡中，小一点的饼图，把价格等级颜色 去掉，然后小饼图就全部由默认灰色填充，再点击颜色，选择白色。

至此环形图就做好了。

最后再给打的饼图添加标记就好了。和之前做饼图添加标记一样。

## 智能显示做环形图的坑

用智能显示做好一个饼图，后续做环形图的步骤和上面一样。

但是，到了设置其中一个饼图大小的时候，会发现另一个饼图的大小也随着拖动一起变动。

这是因为智能显示作出的饼图，在标记卡中，不仅按计数设置了角度，也按计数设置了大小。把两个饼图的计数大小取消掉就好了。

# 基本表

## 酒店数量基本表

地区拖到行。

酒店计数拖到标记卡文本。

# 凸显表

## 各个地区酒店数量凸显表

做法一：在刚才做好的基础表上，直接在智能推荐里选择凸显表。

做法二：在基本表的基础上，再拖酒店计数到颜色上。这时每个地区对应的酒店数量的数值数字有了颜色，并且按数值大小颜色深浅不同。

但只是数字有了颜色，我们要的是每个单元格有颜色并且按数值大小变化深浅。

这时在标记卡-下拉框-选择方形。就做好了。

# 2值凸显表

刚才凸显表的基础上，做2值凸显表，就是非黑即白，数据高于某个值全都是一种颜色，低于某个值全都是另一种颜色。

点击-标记卡颜色-编辑颜色

色板选一个两头对比鲜明的颜色。

勾选渐变颜色，设置成2阶，就是只有2种颜色。这时如果直接点确定发现，确实是只有2种颜色，但不是按某个值来划分，而是最大值是一个颜色，其他所有制是另一个颜色。

还需要点击高级-勾选中心-设置一个值。高于这个值是一种颜色，低于这个值是另一种颜色。

# 树状图

## 不同类型电影数量与票房的树状图

三个数据 类型 数量 票房

类型维度拖到行。

计数度量拖到列。

智能推荐-选择树状图。

此时树状图生成好了。但是还有票房没加进去。此时标记卡中看到，计数也就是数量，即有大小表示又有颜色表示，所以可以把其中一个去掉比如颜色，把票房拖到颜色上。

这里票房是维度，如果直接拖到颜色上，会显示每一个票房。需要拖到度量，在拖到颜色上，这样就是每个类型的票房总和。

做好后发现树状图右下角，这些类型电影数量太少显示的太小，没必要显示。可以通过筛选器剔除。

一是把计数拖到筛选器中，设置要显示的数量范围。

二可以在画布右边，智能推荐下边空白区-右键-筛选去-选择计数，图例那里就出来了一个针可以拖动选择显示数量的筛选器。

# 气泡图

## 不同类型电影数量与票房气泡图

类型维度拖到行。计数度量拖到列。

智能推荐-选择气泡图。

票房度量拖到颜色。

## 动作类型电影 动态 气泡图

动态图一般都要用到时间，随之时间变化的动态。

上映时间维度是字符串类型，先右键-更改数据类型-选择日期。把日期维度拖到页面卡中。做动态图一定要把日期放到页面里。

这里日期里有个null值，我们不要null值，可以把日期在拖到筛选器里，把null去掉。

接下来，要看的是动作电影，因此把类别维度也拖到筛选器上，只选择动作。

把累计票房拖到列，计数拖到行。这样画布中就显示出每一年、动作电影、的总票房大小和电影数量大小。

右侧图里区会显示播放工具，这个就是日期拖到页面中生成的。按播放按钮，图就可以按照年份增加动起来了。

播放工具下边有个显示历史记录，这个意思就是可以显示动图的历史轨迹，就是播放轨迹。

点击显示历史记录，选择全部，设置标记和轨迹的格式就可以了。

# 词云

## 电影类型词云图

按照每个类型的电影数量多少，展示电影类型词云图。

tableau没有直接做词云图的方法。做词云图就是先做出气泡图。

拖动类型维度到列，拖动计数度量到行。智能推荐-气泡图。

然后在标记卡-图形选择中-选择文本。这样词云就出来了。

再把类型拖到颜色。

# 标靶图

在基本条形图的基础上，增加一下参考线、参考区间，帮助分析人员了解两个度量之间的关系。

通常是用来比较计划值和实际值。达标情况。

## 二月份各省市电量销售额完成情况

首先统计周期（日期）放到筛选器，只看2月。

其次，省市维度放到列，当期值放到行。交换行列，做成横向条形图。标靶图一般都是横向条形图。

右键横轴（当期值轴）-添加参考线-选择线-范围选择整个表或每区。

因为我们现在的图里只有一个区，所以整个表和每区的效果一样的。如果图里有多个区，那么每区就是按照各自区的数据来添加参考线，整个表就是忽略区，按照所有区也就是整个表的数据来添加参考线。还有一个单元格选项，选择单元格，就是按照每个单元格格子的数据来添加参考线。

范围选择整个表或每区后，设置参考线的值。在线-值选项里看到目前只有一个总和（当期值）选项，这个选项是让你选择要使用哪个数据作为参考线的值，右边还有一个选项，有总和、最大值、最小值、平均值等，这个是让你选择以那种计算方式对你选择的数据进行计算来生成参考线的值。

因为现在表里只有一个度量数据，就是总和（当期值），所以这里只有这一个选项。

但我们要做的是各个省市的电量销售额完成情况。所以需要用目标值（也就是度量数据中的月度计划值）作为参考线的值。

把月度计划值拖到标记卡-详细信息。然后在点击参考线-编辑-线-值，此时值选项中就有了总和（月度计划值）选项。

# 甘特图

甘特图主要是用在项目管理里面。通过活动列表和时间刻度，以图示的方式形象的表示出任何特定的项目和它的持续时间。

## 供应商交货延迟情况甘特图

有实际交货日期、计划交货日期两个日期类型的维度。

把计划交货日期维度拖到列。此时默认的日期级别是年，点击下拉三角-选择-下面的天。此时看到列功能区上的计划交货日期变成了绿色胶囊，变成了度量。而如果选择上面的天，还是蓝色，还是维度。这里要选择下面的天。

接下来，把供应商名称维度拖到行，把物资类别维度拖到行。查看每一个供应商下边每一种物资的计划交货日期。

接下来怎么看是晚交货还是早交货呢，这里需要创建计算字段。

在实际交货日期右键-创建-计算字段。字段名称叫交货延迟天数。计算公式是 [实际交货日期] - [计划交货日期]，如果>0说明延迟交货了，如果<0说明提前交货了。点击确定，在度量里就出现了创建的计算字段。

此时，把交货延迟天数计算字段，拖到大小，这是图中的条形图，就按照延迟天数有了大小。

再把延迟天数拖到颜色，编辑颜色，用2值凸显表的方式，只设置2个色阶，这样提前的是一种颜色，延迟的是一种颜色。

至此这个甘特图就做好了。

在开始把计划交货日期拖到列上，选择日期级别的时候，菜单中有两部分相同的年、月、天选项，上面的部分选择后还是维度，下面的部分选择后就是度量。这里我们需要的是度量，为什么是度量呢，因为我们要做的是供应商交货延迟情况甘特图，所以我们想看的是每一个供应商下的每一种物资类别的交货时间是否延迟，所以供应商和物资类别明显是两个维度，现在有了维度，还需要度量才能组成图标。那么我们的思路就是把计划交货日期作为度量放到图上，现在就有了每个供应商的每个物资类别的计划交货日期。然后再通过计算字段计算出延迟天数，用延迟天数控制每个条形图的大小和颜色，来区分每个条形图是否延迟以及延迟天数的长短。

# 瀑布图

## 超市不同字类别盈亏情况瀑布图

连接数据后，数据源页面发现这个excel下有两个sheet，人员表和订单表。

我们做图两个表的数据都需要用到，因此需要把两个表合并成一个表，这里使用表连接，把两个表都拖过去，默认用了内连接的方式连接，连接依据是地区字段，因为两个表都有地区字段。

现在有了数据，开始做表。

到工作区，把子类别维度拖到列，利润度量拖到行。现在先做出来了一个各子类别总利润的条形图。

接下来在此基础上做瀑布图。

先按排序按钮，对条形图排个序。

然后行功能区的利润上选择快速表计算-汇总。

之前做饼图的时候，为了能显示每一块占总体的占比使用过快速表计算-合计百分比，可以体会出，快速表计算就是一个可以快速计算的功能。

这里又使用了快速表计算-汇总功能，通过观察发现，汇总功能就是，从维度最左边那一列开始向右累加。比如说，第一列就是它本身的值，因为他前面没有列了。第二列=第一列+它本身的值。第三列=第二列汇总后的值+它本身的值。第四列=第三列汇总后的值+它本身的值...以此类推知道最后一列。

接下来，在标记卡中选择图形-选择甘特图。这是每个条形图的柱子变成了一条横线，这个代表着起始点。

接下来，创建一个计算字段，字段名：长方形高度。计算公式：-[利润]。然后把计算字段拖到大小上。

这是瀑布图就初具规模了。

首先对利润进行快速表计算-汇总，能够反映出整体的利润增常情况。

接着图形改成甘特图，让每个柱子的高度位置不变，仍能够反映总体利润的趋势，同时柱子变成一条线，作为自己的起始点。

然后用计算字段-[利润]放到大小上，来显示每个柱子自己的实际利润大小。这里为什么是-[利润]呢，因为默认是对正值向上绘制柱子的，所以取负让柱子向下绘制，因为瀑布是向下流淌的。

接下来，把计算字段拖到颜色上，编辑下颜色用2阶，还可以对计算字段也选择快速表计算-汇总，这样利润汇总是负的列就是一个颜色，汇总是整的就是一个颜色。

最后在菜单栏-分析-合计-显示行总和，在图的右边会出来一个利润的总和。

现在就是一个完美的瀑布图。

# 数据集合并

和mysql一样，内连接，左外，右外，全外。

# 符号地图

## 超市销售情况符号地图

看下各个国家它的销售额是怎么样的。

 首先数据中地理位置数据的字段是字符串类型，我们需要转换成地理位置类型。

在国家/地区维度上右键-地理角色-选择对应的地理单位。注意不是更改数据类型，而是选择地理角色。

接下来，要用地理位置做个地图，做地图的方式至少有4种。

最简单的方式是，直接拖动国家/地区地理维度到画布上，tableau自动生成了一个地图。每个数据中的国家地图上都有一个默认的圆点图形。可以自己选择其他图形。

再把销售额度量，拖到大小上，地图上的圆点大小按照销售额大小而改变。

现在发现地图上国家的名字被圆点挡住了，看起来不方便，可以再把国家/地区维度拖到标签上，这样在圆点下面就显示出每个国家名字。

这是又发现标签的国家名字和地图自身显示的国家名字都同时显示了，这是在菜单栏选择-地图-地图层-勾选掉国家/地区名称，此时地图自带的国家名称就没有了。

现在一个显示各个国家销售额情况的地图就做好。

但是又个问题，地图右下角有个未知，有2个国家/地区tableau没有识别出来，我们点击位置-弹出一个窗口，先选择第一个选项编辑位置，这里就能显示数据中哪些国家没有被识别出来，可以自己编辑选择国家。

如果说未识别的国家太多了，不想一个一个找了，干脆让它们都不显示。这时可以选择窗口的第二个选项-筛选数据，未识别的国家就自动被加到筛选器中剔除掉了。

其他创建地图的方法：

- 直接在国家/地区维度双击
- 把度量中的经度拖到列，维度拖到行，就出来了地图，再把国家/地区维度拖到详细信息，地图上各国家就有了圆点。
- 同时选中度量中的经度纬度，在智能推荐里选择地图，也出来了地图，再把国家/地区维度拖到详细信息，地图上各国家就有了圆点。

# 智能显示（智能推荐）

没有往行列功能区放任何东西的时候，智能推荐都是灰色不可用。

# 插入自定义形状

标记卡中，选择图形的选项里有一个形状，就是形状图形，用各种形状来制作图。

图形选择形状后，在下面会出来一个形状选项卡，点击这里可以选择各种tableau自带的图形形状。

如果没有你满意的，想使用自己的图形形状，就要自己插入自定义形状了。建议是png格式的图片。

如何添加自定义形状呢？

在tableau安装目录下，install/defaults/shapes/，这下面的文件夹就是各种形状，可以自己新建个文件夹，文件夹名用英文，然后放入自己的形状图片。

# 仪表板高级应用

就是仪表板普通应用，就是把工作表拖进来，布局就完事了

# 填充地图

## 各省市售电量填充地图

省市维度右键-地理角色-选择州/省/市/自治区，双击省市维度生成地图。

当期值度量拖到颜色，地图自动给每个省市地区填充了颜色，颜色深浅按照当期值大小。

# 多维地图

多维地图就是一块又一块的地图形成矩阵形式。

## 各省市售电量多维地图

在刚才的填充地图基础上，在拖一些其他维度到行列功能区上，就是多维地图，每个维度上都有自己的一个地图统计。

# 混合地图

混合地图就是地图和其他的图结合。

## 各省市售电量混合地图

在填充地图的基础上，和制作环形图的方法一样。

在行功能区，按住command，拖动纬度度量，复制出一个维度度量。此时图中有两个行，然后选择双轴，两个地图重合。

在标记卡中，第一个地图就还是让他按照当期值度量填充显示。

第二个地图可以把当期值颜色去掉，拖入累计值度量到大小，拖入同期累计值度量到颜色。这样地图上各省有圆点标记，圆点大小表示累计值的大小，圆点的颜色深浅表示了同期累计值的大小。

这就是混合地图。可以展示很多信息。各省的地图填充颜色深浅表示了各省当期值的大小，各省的圆点大小表示累计值的大小，圆点的颜色深浅表示了同期累计值的大小。

# 数据分层

分层结构是一种维度之间，自上而下的组织形式。

tableau默认包含对某些字段的分层结构，比如日期，日期与时间，地理角色。比如日期字段包含了年、季度、月、日这样的分层结构。

## 人工坐席接听数据

创建层级有2种方式。

- 方式一：在中心维度右键-层级-创建层级，输入创建的层级名称，就创建完成。把其他维度拖进来，把部拖到中心下面，组拖到部下面，班拖到组下面。层级关系就是按照层级里各维度的顺序决定的，最上面的是最高层级，依次往下降低。
- 方式二：直接拖动中心维度到部维度上，弹出输入层级名称对话框，这样也创建了一个层级。要注意这种创建方式里面的层级顺序。

层级之间是不能嵌套的。

# 数据分组

组是维度成员，或者是度量的离散值，的组合。通过分组可以实现维度成员的重新组合，以及度量值的按范围分类。

组的字段图标是一个回形针图标。

在tableau中，要归类重组维度成员有很多种方式，分组是最常见、最快捷的方式。

需要注意的是，组是不能用于创建计算字段的。也就是说组是不能够出现在公式中的。

## 人工坐席接听数据

把班维度拖到行，人工服务接听量度量拖到列。

发现图中，班维度值中，有13班、13班（15批新人），这两个都是13班的；15班、15期新人，这两个都是15班的；长白班、长白班1、长白班2、长白班3，这几个都是长白班的。我们可以通过分组的方式把他们各自融合。

创建组也有2种方式：

- 方式一：在班维度右键-创建-组
- 方式二：在图中要创建组的维度值上右键-组。这里要注意实在图形上右键，而不是在列名称上。

创建组后，新生成一个班（组）维度，在它上面右键-编辑组，可以对分组进行编辑。

# 数据集

集是满足某些条件的数据子集，它是维度的部分成员。

集的图标是两个相扣的圆环。

集的类型：

- 常量集：也叫静态集，他是不会改变的，不会随着数据的改变而更新。常量集可以用一个或多个维度。常量集是在视图中选择创建。
- 计算集：也叫动态集，他是会改变的，会随着数据的改变而更新。计算集只能用一个维度。计算集是在数据窗口创建。

集的用途：

- 集内外成员的对比分析。
- 集内部成员的对比分析。

## 全球超市订单，找出负利润的国家（静态集）

国家维度放到列，利润度量放到行。

排序下，在视图上托选出利润为负的所有国家，鼠标悬停在选中的图上，会悬浮出来一个选项卡，上面有之前的创建组，还有创建集。

点击创建集，输入集的名称-负利润国家。维度中就出现了创建的负利润国家集。

## 全球超市订单，找出负利润的产品（动态集）

产品名称维度-右键-创建-集。

弹出创建集对话框，选择条件-按字段-选择利润，<=，0，输入集的名称-负利润产品。

除了条件，还有一个顶部选项，顶部就是可以选择top10这种，里面也可以选择底部，就是最后10名。

此处也可以在创建一个销量top100产品集。

这样就创建了一个动态集，这个集是产品名称维度的子集，当把它拖到行列功能区上，他会根据创建时的条件，自动把利润<=0的产品加到自己的集内。

接下来把负利润产品集放到行，利润放到列。

此时图中显示了内、外两个数据。内就是产品负利润集内的数据，也就是所有利润为负的产品的利润总和。

我们可以在行功能区-负利润产品集上右键-在集内显示成员，意思是我要在图上只显示集内的数据。

## 合并集

有时候只用一个集没办法轻松解答我们的问题。合并集会为我们的分析带来额外的价值和强大的功能。可以合并居于同一个维度的集。

注意是同一个维度。

在刚才创建了几个集，负利润国家、负利润产品、销量top100产品。

现在创建合并集，在负利润产品上右键-创建合并集，在弹出的对话框中选择要合并的另一个集，发现只能选择销量top100产品这个集。

这是因为负利润产品、销量top100产品这两个集都是根据产品名称这个维度创建的，都是它的自己，而负利润国家是根据国家维度创建的。所以只能合并他俩，也就是只能合并同一个维度的集。

然后选择合并方式，和之前数据源页面数据集的合并有所不同，四种方式，内（交集），外（并集），左（左除右），右（右除左）。

- 全：并集。意味着把负利润的产品和销量前100的产品所有数据融到一起，形成一个新的集。
- 内：交集。意味着之选出既是负利润、同时销量又前100的产品，形成一个新的集。
- 左：选出负利润，并且销量不是前100的产品。
- 右：选出销量前100，并且利润不为负的产品。

# 计算字段

计算字段是，根据我们的数据源字段，包括维度、度量、参数等等，使用函数和运算符来构造公式来定义的字段。

和其他字段一样，计算字段也能够拖放到功能区里来构建视图。

计算字段还能用于创建新的计算字段。

计算字段的返回值分成数值型、字符型等等。

创建计算字段呢，本质上是利用数据源中的数据，创建一个新的字段，它的值或者成员呢，是根据我们所控制的计算来确定。这种新的字段会保存到tableau的数据源中。但我们不用担心，我们的原始数据是始终保持不变的。

计算字段的类型有三种：

- 基本类型计算字段：对一些常规的数值、日期、字符，做一些比较常规的操作，这样的字段类型。
- 详细信息级别表达式：又称为LOD
- 表计算

## 全球超市订单数据，各个国家成本情况

在度量里有利润字段、销售额字段，我们可以创建一个成本字段，成本就是销售额-成本。

创建计算字段的方式：在字段上右键-创建-计算字段，在数据窗口空白区右键-创建计算字段，在数据窗口顶部下拉三角-创建计算字段。

点击创建计算字段，输入字段名称-成本，输入计算公式，拖动销售额到公式编辑区，输入-，拖动利润到公式编辑区。点击确定。成本计算字段就创建好了。

双击国家维度生成地图，拖动成本字段到颜色，填充每个国家。

# 粒度、聚合、比率

说粒度之前，先创建一个散点图。

## 全球超市订单数据 粒度

利润度量放到列，销售额度量放到行。

这样就出现了一个散点图。但图上只有一个点。显示的是利润、销售额的总和。

现在将市场维度放到颜色，图上一个点变成了多个点，

粒度就是源于tableau的散点图，他表示数据的颗粒浓度。

最大的浓度状态就是，点击菜单栏分析-取消聚合度量，这样每一个利润、销售额都在图上展示了。

## 聚合

聚合分两种，度量聚合和维度聚合。大多数情况下我们用的都是度量聚合。

每一次我们把度量拖到行列功能区上，tableau都默认在前面加一个总计。这个总计就是对度量的一种聚合。

维度的聚合是什么样呢？比如我们把产品ID维度拖到列，右键-度量，他有最大值、最小值、计数、计数（不同）四种聚合方式。

通常很少用到维度聚合。

最后还有默认聚合的设置，在度量上右键-默认属性-聚合，可以看到默认选中的就是总计，所以每次把度量多到行列上都是总计，我们在此可以选择其他的默认聚合方式。

## 比率

先创建一个类别分层结构，名字就叫类别，分层中内容是-类别-子类别-行ID。

再来创建几个计算字段：

- 先创建一个利润率计算字段：字段名称是利润/销售额，公示就是[利润]/[销售额]。
- 再创建一个计算字段：名称是 sum(利润)/sum(销售额)，公示也是sum([利润])/sum([销售额])。

现在来比较一下，这两种计算字段的利润率有什么区别。

将维度中的度量名称放到筛选器。只看刚才的两个计算字段以及利润字段。

接下来，把刚才的类别分层放到行，度量名称放到列。为什么这么高，我们现在想建立一个数据表，它的列是度量值名称，就是度量名称，行是类别。

再把度量中的度量值放到标记里面，直接拖到标记卡的空白区就可以，和拖到详细信息的效果一样。再把度量值拖到文本上，这样数据表中就会显示出对应的数值是多少。

设置下两个计算字段的格式，设置成百分比。

好，现在可以发现，当类型分层展开到行ID时，两个计算字段计算出的利润率是一样的，而类型收起到子类别时，利润/销售额字段计算出的利润率比如标签子类别高达30000%多，这个显然是错的。而sum(利润)/sum(销售额)是20%多，这个显然是对的。

为什么会这样，根本原因是聚合方式不同。

利润/销售额字段，在标记卡下面可以看到，总计(利润/销售额)，比如标签子类别下，他是先计算标签子类别下的每一个行ID的利润/销售额，就是每一个行ID的利润率，然后再把标签子类别下所有行ID的利润率加起来，就是他得出的标签子类别的利润率。

sum(利润)/sum(销售额)字段，他在标记卡下面显示的是 聚合(sum(利润)/sum(销售额))，他是把标签子类别下的所有行ID的利润先求和，再对标签子类别下的所有行ID的销售额求和，最后两个相除，计算出标签子类别的利润率。显然这种才是正确的计算方式。

# 详细级别表达式

详细级别表达式是放在{}内部的，{}内部第一部分是关键字：include，fixed，exclude。

## 全球超市订单数据

在这个数据中，每一行数据有订单ID、产品名称、利润这三个字段，利润是这个订单下这个产品的利润，而不是这个订单的总利润，

那么在视图中的利润统计的也是每个产品的利润。不是统计每个订单的利润。

现在我想要统计每个订单的利润。就可以使用计算字段，创建详细级别表达式。

创建计算字段，字段名订单利润，公示输入：`{include [订单ID]: sum([利润])}`。 include是我们的关键字，订单ID是我们对应的维度，后面是我们的聚合表达式。关键字还有fixed，exclude，他们的区别：

- include：在视图中其他的任何维度之上，使用指定的维度进行计算。
- fixed：使用指定的维度计算值，不参考视图中的其他任何维度。
- exclude：忽略指定的维度，既是在视图中使用了该维度也要进行忽略。

include和fixed的区别：

![](https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-21_17-03-33.jpg)

同样是算订单的利润，第三行，同一个订单ID下有比利时，法国两个维度。

对于fixed，我不管你几个国家，我只对于这个订单ID，他的利润我全都加起来，计算出一个值，然后给法国和比利时都显示为这个值。

对于include，我分别对于你比利时和法国，对于同一个订单ID，分别进行计算。计算出一个相应的利润值，然后分别显示给你。

# 表计算

## 快速表计算

汇总：就是累加。

差异：就是当前值-上一个值。还可以在胶囊上右键-相对于，选择是上一个，下一个，第一个，最后一个。

百分比差异：（当前值-上一个值）/ 上一个值

合计百分比：当前值/所有值得和，就是看当前值在总体中的占比。

排序：对当前值一个排名，按照他在所有值中的大小，从大到小排。

百分位：就是对所有值按照从大到小的顺序往下排，最大的是100%，最小的是0%，中间的值按照你排名的线性比例进行一个分割。

移动平均：默认是移动平均值是3个值的移动平均，默认说明是前两个到后0个，就是当前值的前两个+当前值，这三个值的平均值。移动平均一般在股票市场用的多。 

## 自定义表计算

自定义一个按月的利润移动平均值。

创建计算字段，字段名称-按月移动平均值。

公式输入：window_avg(sum([利润]), -2, 0)。意思是当前值向前推2个，求这三个值的利润的移动平均值。

在公式区右下角有个默认表计算，点击，根据以下因素计算-选择-订购日期，所在级别-选择订购日期 月，点击确定。 

现在就创建了一个计算3个月的利润移动平均值的计算字段。和sql中的窗口函数类似。

上面3个月是在公式里写死的，我们还可以创建参数，来动态的调整时间范围。

在数据窗格空白处右键或点击顶部下拉三角，创建参数。

参数名取为n月移动平均，数据类型-整数，当前值给个2，允许的值选择范围-最小值1-最大值12-步长1。确定。

然后编辑刚才创建的按月移动平均计算字段，把-2的2删掉，把n月移动平均参数拖到这里，确定。

这样公式里就相当于有了变量，就可以动态的计算。

最后在参数上右键-显示参数，在图的右边就出来一个滑块可以选择计算的月数范围。

# 回归分析

回归分析就是，存在或可能存在相关关系的变量，拟合成直线或者曲线，然后呢，据此我们可以总结出已有数据的特征和规律，另一方面还可以预测数据。

# 时间序列分析



