<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;yu-sen.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Mist&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:true,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="基础语句、聚合、分组、约束、多表查询">
<meta property="og:type" content="article">
<meta property="og:title" content="【数据分析】第二阶段：MySQL数据分析实战（一）">
<meta property="og:url" content="https://yu-sen.github.io/20210504174002/index.html">
<meta property="og:site_name" content="昱森笔记">
<meta property="og:description" content="基础语句、聚合、分组、约束、多表查询">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-05_19-44-43.jpg">
<meta property="og:image" content="https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-05_21-50-07.jpg">
<meta property="article:published_time" content="2021-05-04T09:40:02.000Z">
<meta property="article:modified_time" content="2021-06-15T08:04:45.453Z">
<meta property="article:author" content="昱森">
<meta property="article:tag" content="数据分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-05_19-44-43.jpg">


<link rel="canonical" href="https://yu-sen.github.io/20210504174002/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;yu-sen.github.io&#x2F;20210504174002&#x2F;&quot;,&quot;path&quot;:&quot;20210504174002&#x2F;&quot;,&quot;title&quot;:&quot;【数据分析】第二阶段：MySQL数据分析实战（一）&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>【数据分析】第二阶段：MySQL数据分析实战（一） | 昱森笔记</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">昱森笔记</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">MySQL基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">数据库基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.2.</span> <span class="nav-text">MySQL数据库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.</span> <span class="nav-text">SQL语句</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-number">2.1.</span> <span class="nav-text">增删改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5"><span class="nav-number">2.2.</span> <span class="nav-text">查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.3.</span> <span class="nav-text">核心查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-number">2.3.1.</span> <span class="nav-text">排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88"><span class="nav-number">2.3.2.</span> <span class="nav-text">聚合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84"><span class="nav-number">2.3.3.</span> <span class="nav-text">分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#limit"><span class="nav-number">2.3.4.</span> <span class="nav-text">limit</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL%E7%BA%A6%E6%9D%9F"><span class="nav-number">2.4.</span> <span class="nav-text">SQL约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE"><span class="nav-number">2.4.1.</span> <span class="nav-text">主键</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE%E8%87%AA%E5%A2%9E"><span class="nav-number">2.4.1.1.</span> <span class="nav-text">主键自增</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E7%A9%BA"><span class="nav-number">2.4.2.</span> <span class="nav-text">非空</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%94%AF%E4%B8%80"><span class="nav-number">2.4.3.</span> <span class="nav-text">唯一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-number">2.4.4.</span> <span class="nav-text">默认值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="nav-number">2.4.5.</span> <span class="nav-text">外键约束</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%A7%E8%81%94%E5%88%A0%E9%99%A4"><span class="nav-number">2.4.5.1.</span> <span class="nav-text">级联删除</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.</span> <span class="nav-text">多表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.1.</span> <span class="nav-text">交叉连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">笛卡尔积</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.2.</span> <span class="nav-text">内连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">隐式内连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">显示内连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.5.3.</span> <span class="nav-text">外连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.5.3.1.</span> <span class="nav-text">左外连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.5.3.2.</span> <span class="nav-text">右外连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">2.5.4.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#join-on-and-%E5%92%8C-join-on-where-and"><span class="nav-number">2.5.5.</span> <span class="nav-text">join on and 和 join on where and</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.6.</span> <span class="nav-text">合并查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.7.</span> <span class="nav-text">子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#where%E5%9E%8B%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.7.1.</span> <span class="nav-text">where型子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exists%E5%9E%8B%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.7.2.</span> <span class="nav-text">exists型子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#from%E5%9E%8B%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.7.3.</span> <span class="nav-text">from型子查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">3.</span> <span class="nav-text">SQL语句执行顺序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B1"><span class="nav-number">4.</span> <span class="nav-text">案例1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B2"><span class="nav-number">5.</span> <span class="nav-text">案例2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B3"><span class="nav-number">6.</span> <span class="nav-text">案例3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B4"><span class="nav-number">7.</span> <span class="nav-text">案例4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95"><span class="nav-number">8.</span> <span class="nav-text">扩展</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="昱森"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">昱森</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yu-sen.github.io/20210504174002/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="昱森">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="昱森笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【数据分析】第二阶段：MySQL数据分析实战（一）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-04 17:40:02" itemprop="dateCreated datePublished" datetime="2021-05-04T17:40:02+08:00">2021-05-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-06-15 16:04:45" itemprop="dateModified" datetime="2021-06-15T16:04:45+08:00">2021-06-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">基础语句、聚合、分组、约束、多表查询</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a>MySQL基础</h1><h2 id="数据库基本概念"><a href="#数据库基本概念" class="headerlink" title="数据库基本概念"></a>数据库基本概念</h2><p>数据库是按照数据结构来组织、存储和管理数据的仓库。其本质是一个文件系统，以文件的形式将数据保存在电脑上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">文件 --&gt; 文件系统 --&gt; 计算机磁盘</span><br></pre></td></tr></table></figure>

<p>数据库（DB），数据库管理系统（DBMS）</p>
<p>关系型数据库（RDB）：关系型数据库是创建在关系模型基础上的数据库。</p>
<p>关系模型：有明确的行和列的二维表格模型。（就像excel表一样）</p>
<p>IOE：IBM小型机，Oracle数据库，EMC易安信。</p>
<p>客户端与服务端建立连接；写SQL，执行SQL语句操作MySQL数据库。</p>
<p>字段：表中每一列成为一个字段，字段有自己的属性，如字段类型、字段大小等，字段类型决定了字段能够存储哪种数据。字段属性在建表时就必须定义好。</p>
<p>索引：索引是一种单独的、物理的数据库结构。它依赖于表建立。</p>
<p>视图：视图是从一张或多张表中到处的表（也称虚拟表），是用户产看表中数据的一种方式。</p>
<h2 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h2><p>MySQL是C和C++编写的。</p>
<p>MySQL支持多线程。</p>
<p>MySQL存储引擎：存储引擎是MySQL数据库的核心。它决定了数据如何存储，查询的时候如何搜索数据，索引如何创建等等。</p>
<p>常用存储引擎：</p>
<ul>
<li>InnoDB：MySQL5.1版本之后默认存储引擎。</li>
<li>MyISAM：MySQL5.1版本之前默认存储引擎。</li>
<li>Memory</li>
</ul>
<p>MySQL数据类型主要分为数值型、字符串型、日期时间型三大类。</p>
<p>字符串型char和varchar：</p>
<ul>
<li><p>char固定长度，char(5)会在内存中占用5个字符的空间，即使只存入了3个字符。</p>
</li>
<li><p>varchar可变长度，varchar(5)存入3个字符，就只占用3个字符的空间。</p>
</li>
<li><p>char浪费空间，但查询时整体匹配，效率更高，比如存入abc，查询时会直接匹配整体是否是abc。</p>
</li>
<li><p>varchar节省空间，但查询时不是整体匹配，效率不高，比如存入abc，查询时先匹配a再匹配b再匹配c。</p>
</li>
</ul>
<p>MySQL Server安装目录下，bin目录下的mysql就是自带的命令行客户端。</p>
<p>访问数据库命令行：mysql -h127.0.01 -uroot -p123456</p>
<ul>
<li>mysql：使用mysql客户端访问服务端</li>
<li>-h127.0.01：当前服务端是本机，所以使用-h127.0.0.1指定访问本地127.0.0.1地址的服务。因为服务端在本地，这部分也可以不写会自动访问本地服务。</li>
<li>-uroot：登陆用户是root</li>
<li>-p123456：登陆密码是123456</li>
</ul>
<h1 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h1><p>SQL语句按功能分为以下几类：</p>
<ul>
<li>DDL语句（Data Definition Language 数据定义语言)</li>
<li>DML语句（Data Manipulation Language 数据操作语言)</li>
<li>DQL语句（Data QueryLanguage 数据查询语言)</li>
<li>DCL语句（Data Controll Language 数据控制语言)</li>
</ul>
<p><strong>SQL语句的执行顺序：1、最先执行from tab；2、where语句是对条件加以限定；3、分组语句【group by…… having】；4、聚合函数；5、select语句；6、order by排序语句。</strong></p>
<h2 id="增删改"><a href="#增删改" class="headerlink" title="增删改"></a>增删改</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 新建数据库 create database 数据库名;</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db1;</span><br><span class="line"><span class="comment">-- 新建数据库，并指定字符集 create database 数据库名 character set 字符集;</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db1_1 <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换数据库 从db1 切换到 db1_1 </span></span><br><span class="line">USE db1_1;</span><br><span class="line"><span class="comment">-- 查看当前正在使用的数据库 </span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"><span class="comment">-- 查看Mysql中有哪些数据库 </span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="comment">-- 查看一个数据库的定义信息 </span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE db1_1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将数据库db1 的字符集 修改为 utf8 </span></span><br><span class="line"><span class="keyword">ALTER</span> DATABASE db1 <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8;</span><br><span class="line"><span class="comment">-- 查看当前数据库的基本信息，发现编码已更改 </span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE db1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除某个数据库 </span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE db1_1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="comment">/* CREATE TABLE 表名(</span></span><br><span class="line"><span class="comment">字段名称1 字段类型(长度)，</span></span><br><span class="line"><span class="comment">字段名称2 字段类型 注意 最后一列不要加逗号</span></span><br><span class="line"><span class="comment">);*/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> category(</span><br><span class="line">		cid <span class="type">INT</span>,</span><br><span class="line">    cname <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">快速创建一个表结构相同的表(仅复制表结构，不会复制数据)</span></span><br><span class="line"><span class="comment">create table 新表名 like 旧表名;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">-- 创建一个表结构与 test1 相同的 test2表 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test2 <span class="keyword">LIKE</span> test1;</span><br><span class="line"><span class="comment">-- 查看表结构 </span></span><br><span class="line"><span class="keyword">DESC</span> test2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前数据库中的所有表名 </span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"><span class="comment">-- 显示当前数据表的结构 </span></span><br><span class="line"><span class="keyword">DESC</span> category;</span><br><span class="line"><span class="comment">-- 查看创建表的SQL语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> category;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 直接删除 test1 表 </span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> test1;</span><br><span class="line"><span class="comment">-- 先判断表是否存在 再删除test2表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> test2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表名 rename table 旧表名 to 新表名;</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> category <span class="keyword">TO</span> category1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向表中添加列 alter table 表名 add 字段名称 字段类型</span></span><br><span class="line"># 为分类表添加一个新的字段为 分类描述 cdesc <span class="type">varchar</span>(<span class="number">20</span>) </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category <span class="keyword">ADD</span> cdesc <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表中列的数据类型或长度 alter table 表名 modify 字段名称 字段类型</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category MODIFY cdesc <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列名称 alter table 表名 change 旧列名 新列名 类型(长度);</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category CHANGE cdesc description <span class="type">VARCHAR</span>(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除列 alter table 表名 drop 列名;</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category <span class="keyword">DROP</span> description;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="comment">-- insert into 表名 (字段名1，字段名2...) values(字段值1，字段值2...);</span></span><br><span class="line"><span class="comment">-- 方式1: 插入全部字段， 将所有字段名都写出来</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student (sid,sname,age,sex,address) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;孙悟 空 &#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;男 &#x27;</span>,<span class="string">&#x27;花 果 山 &#x27;</span>);</span><br><span class="line"><span class="comment">-- 方式2: 插入全部字段，不写字段名</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">&#x27;孙悟饭&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;地球&#x27;</span>);</span><br><span class="line"><span class="comment">-- 方式3:插入指定字段的值</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> category (cname) <span class="keyword">VALUES</span>(<span class="string">&#x27;白骨精&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更改数据，更新数据是更新某一列数据</span></span><br><span class="line"><span class="comment">-- 不带条件的修改 update 表名 set 列名 = 值</span></span><br><span class="line">UPDATE student <span class="keyword">SET</span> sex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"><span class="comment">-- 带条件的修改 update 表名 set 列名 = 值 [where 条件表达式:字段名 = 值 ]</span></span><br><span class="line">UPDATE student <span class="keyword">SET</span> sex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">WHERE</span> sid <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"><span class="comment">-- 一次修改多个列</span></span><br><span class="line">UPDATE student <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">20</span>,address <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span> <span class="keyword">WHERE</span> sid <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名;</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br><span class="line"><span class="comment">-- 指定条件 删除数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 字段名 <span class="operator">=</span> 值];</span><br></pre></td></tr></table></figure>

<p><strong>当一个表中数据条数非常多，又要做删除动作的时候，如果用delete会很慢，那我们可以使用 truncate 。</strong></p>
<p><strong>delete from 表名; 不推荐. 有多少条记录 就执行多少次删除操作. 效率低。</strong></p>
<p><strong>truncate table 表名: 推荐. 先删除整张表, 然后再重新创建一张一模一样的表. 效率高。</strong></p>
<h2 id="查"><a href="#查" class="headerlink" title="查"></a>查</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名</span><br><span class="line"><span class="comment">-- 查询某一列</span></span><br><span class="line"><span class="keyword">select</span> 列名<span class="number">1</span>,列名<span class="number">2</span> <span class="keyword">from</span> 表名</span><br><span class="line"><span class="comment">-- 使用 AS关键字,为列起别名 </span></span><br><span class="line"><span class="keyword">SELECT</span> eid <span class="keyword">AS</span> <span class="string">&#x27;编号&#x27;</span>, ename <span class="keyword">AS</span> <span class="string">&#x27;姓名&#x27;</span> , sex <span class="keyword">AS</span> <span class="string">&#x27;性别&#x27;</span> <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">-- AS 可以省略 </span></span><br><span class="line"><span class="keyword">SELECT</span> eid <span class="string">&#x27;编号&#x27;</span>, ename <span class="string">&#x27;姓名&#x27;</span> , sex <span class="string">&#x27;性别&#x27;</span> <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">-- 使用distinct 关键字,去掉重复部门信息 </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_name <span class="keyword">FROM</span> emp;</span><br><span class="line"><span class="comment">-- 运算查询 (查询结果参与运算)</span></span><br><span class="line"><span class="keyword">SELECT</span> ename , salary <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">FROM</span> emp;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>比较运算符</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>&gt; &lt; &lt;= &gt;= = &lt;&gt; !=</td>
<td>大于、小于、小于(大于)等于、等于、不等于</td>
</tr>
<tr>
<td>BETWEEN …AND…</td>
<td>显示在某一区间的值 <br />例如: 2000-10000之间: Between 2000 and 10000</td>
</tr>
<tr>
<td>IN(集合)</td>
<td>集合表示多个值,使用逗号分隔,<br />例如: name in (悟空，八戒) in中的每个数据都会作为一次条件,只要满足条件就会显示</td>
</tr>
<tr>
<td>LIKE ‘%张%’</td>
<td>模糊查询<br />通配符%，表示匹配任意多个字符串<br />通配符_，表示匹配一个字符<br />where name like ‘%王%’; – name中有王的<br />where name like ‘王%’; – name中以王开头的<br />where name like ‘_王%’；– name中第二个字是王的</td>
</tr>
<tr>
<td>IS NULL</td>
<td>查询某一列为NULL的值, 注: 不能写 = NULL</td>
</tr>
<tr>
<td><strong>逻辑运算符</strong></td>
<td></td>
</tr>
<tr>
<td>And &amp;&amp;</td>
<td>多个条件同时成立</td>
</tr>
<tr>
<td>Or ||</td>
<td>多个条件任一成立</td>
</tr>
<tr>
<td>Not</td>
<td>不成立，取反。<br />和IS NULL组合使用，就是查询字段不是Null的数据。<br />where dept_name IS NOT NULL;</td>
</tr>
</tbody></table>
<h2 id="核心查询"><a href="#核心查询" class="headerlink" title="核心查询"></a>核心查询</h2><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段名 FROM 表名 [WHERE 字段 &#x3D; 值] ORDER BY 字段名 [ASC &#x2F; DESC]</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 默认升序排序 ASC</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary;</span><br><span class="line"><span class="comment">-- 降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- 组合排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>, eid <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>Order by不会影响源数据，只用于展示结果。</p>
<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p>也称为聚合统计或者聚合查询，使用聚合函数纵向查询，对某一列的值进行计算，然后返回一个单一的值(另外聚合函数会忽略null空 值。</p>
<p>聚合函数：</p>
<ul>
<li>count(字段) 统计指定列不为NULL的记录行数。</li>
<li>sum(字段) 计算指定列的数值和。</li>
<li>max(字段) 计算指定列的最大值。</li>
<li>min(字段) 计算指定列的最小值。</li>
<li>avg(字段) 计算指定列的平均值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 聚合函数(字段名) FROM 表名;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1</span> 查询员工的总数</span><br><span class="line"><span class="comment">-- 统计表中的记录条数 使用 count()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(eid) <span class="keyword">FROM</span> emp; <span class="comment">-- 使用某一个字段 </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emp; <span class="comment">-- 使用 *</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> emp; <span class="comment">-- 使用 1,与 * 效果一样</span></span><br><span class="line"><span class="comment">-- 下面这条SQL 得到的总条数不准确,因为count函数忽略了空值 </span></span><br><span class="line"><span class="comment">-- 所以使用时注意不要使用带有null的列进行统计</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(dept_name) <span class="keyword">FROM</span> emp;</span><br><span class="line"></span><br><span class="line">#<span class="number">2</span> 查看员工总薪水、最高薪水、最小薪水、薪水的平均值</span><br><span class="line"><span class="comment">-- sum函数求和, max函数求最大, min函数求最小, avg函数求平均值 </span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> <span class="string">&#x27;总薪水&#x27;</span>, </span><br><span class="line">	<span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> <span class="string">&#x27;最高薪水&#x27;</span>, </span><br><span class="line">	<span class="built_in">MIN</span>(salary) <span class="keyword">AS</span> <span class="string">&#x27;最低薪水&#x27;</span>, </span><br><span class="line">	<span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> <span class="string">&#x27;平均薪水&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> emp;</span><br><span class="line"></span><br><span class="line">#<span class="number">3</span> 查询薪水大于<span class="number">4000</span>员工的个数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">4000</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">4</span> 查询部门为<span class="string">&#x27;教学部&#x27;</span>的所有员工的个数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;教学部&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">5</span> 查询部门为<span class="string">&#x27;市场部&#x27;</span>所有员工的平均薪水 <span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> <span class="string">&#x27;市场部平均薪资&#x27;</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>⚠️注意：where中不能使用聚合函数，只能通过子查询实现</strong>。<a target="_blank" rel="noopener" href="https://blog.csdn.net/fanbaodan/article/details/84304782">https://blog.csdn.net/fanbaodan/article/details/84304782</a></p>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><p>分组查询指的是使用GROUP BY 语句，对查询的信息进行分组，相同数据作为一组。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">SELECT</span> 分组字段<span class="operator">/</span>聚合函数 <span class="keyword">FROM</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组字段 [<span class="keyword">HAVING</span> 条件];</span><br><span class="line"><span class="comment">-- select后必须出现要分组的字段，除了分组字段、聚合函数，不能出现其他字段</span></span><br><span class="line"><span class="comment">-- where先对源数据过滤，having对分组聚合统计后的数据再过滤</span></span><br></pre></td></tr></table></figure>

<p>Group by 后可以跟多个字段，按照多个字段进行分组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 分组字段<span class="number">1</span>, 分组字段<span class="number">2</span>, 聚合函数 <span class="keyword">FROM</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组字段<span class="number">1</span>, 分组字段<span class="number">2</span> [<span class="keyword">HAVING</span> 条件];</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># store_id 和 salesdate 相同的分为一组</span><br><span class="line"><span class="keyword">select</span> store_id, <span class="built_in">sum</span>(sales_volume), salesdate</span><br><span class="line"><span class="keyword">from</span> store_table</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> store_id, salesdate</span><br></pre></td></tr></table></figure>

<p>分组的目的是为了统计，所以分组一般会与聚合函数一起使用。只进行分组是没有意义的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只分组不统计 这样写没有意义</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> sex; </span><br><span class="line"><span class="comment">-- 分组返回每组的第一条数据</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1</span> 通过性别字段 进行分组,求各组的平均薪资</span><br><span class="line"><span class="keyword">select</span> sex,<span class="built_in">avg</span>(salary)<span class="string">&#x27;平均薪资&#x27;</span> <span class="keyword">from</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> sex;</span><br><span class="line"></span><br><span class="line">#<span class="number">2</span> 查询每个部门的平均薪资 </span><br><span class="line"><span class="keyword">select</span> dept_name<span class="string">&#x27;部门&#x27;</span>,<span class="built_in">avg</span>(salary)<span class="string">&#x27;平均薪资&#x27;</span> <span class="keyword">from</span> emp <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br><span class="line"></span><br><span class="line">#<span class="number">3</span> 查询每个部门的平均薪资, 部门名称不能为<span class="keyword">null</span></span><br><span class="line"><span class="keyword">select</span> dept_name<span class="string">&#x27;部门&#x27;</span>,<span class="built_in">avg</span>(salary)<span class="string">&#x27;平均薪资&#x27;</span> <span class="keyword">from</span> emp <span class="keyword">where</span> dept_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br><span class="line"></span><br><span class="line">#<span class="number">4</span> 查询平均薪资大于<span class="number">6000</span>的部门</span><br><span class="line"><span class="comment">-- 先对源数据where过滤掉部门为null的数据，接着按部门分组聚合统计各部门的平均薪资，最后再通过having过滤出平均薪资大于6000的部门。</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	dept_name <span class="string">&#x27;部门&#x27;</span>,</span><br><span class="line">	<span class="built_in">avg</span>( salary ) <span class="string">&#x27;平均薪资&#x27;</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	emp </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	dept_name <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	dept_name </span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">	<span class="built_in">avg</span>( salary ) <span class="operator">&gt;</span> <span class="number">6000</span>;</span><br></pre></td></tr></table></figure>

<p><strong>where和having的区别</strong></p>
<ul>
<li>where 进行分组前的过滤，where 后面不能写聚合函数</li>
<li>having 是分组后的过滤，having 后面可以写聚合函数</li>
</ul>
<h3 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h3><p>limit是限制的意思,用于限制返回的查询结果的行数 (可以通过limit指定查询多少行数据)</p>
<p>limit 语法是 MySql的方言,用来完成分页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span>,字段<span class="number">2.</span>.. <span class="keyword">FROM</span> 表名 LIMIT <span class="keyword">offset</span> , length;</span><br></pre></td></tr></table></figure>

<p>offset 起始行数，从0开始记数， 如果省略 则默认为 0。<br>length 返回的行数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询emp表中的前<span class="number">5</span>条数据</span><br><span class="line"><span class="comment">-- 参数1:起始值,默认是0; 参数2:要查询的条数 </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp LIMIT <span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp LIMIT <span class="number">0</span> , <span class="number">5</span>;</span><br><span class="line"># 查询emp表中 从第<span class="number">4</span>条开始,查询<span class="number">6</span>条 <span class="comment">-- 起始值默认是从0开始的.</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp LIMIT <span class="number">3</span> , <span class="number">6</span>;</span><br></pre></td></tr></table></figure>

<p><strong>分页</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分页操作 每页显示3条数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp LIMIT <span class="number">0</span>,<span class="number">3</span>; <span class="comment">-- 第1页 </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp LIMIT <span class="number">3</span>,<span class="number">3</span>; <span class="comment">-- 第2页</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp LIMIT <span class="number">6</span>,<span class="number">3</span>; <span class="comment">-- 第3页</span></span><br><span class="line"><span class="comment">-- 分页公式 起始索引 =(当前页 -1)* 每页条数 </span></span><br><span class="line"><span class="comment">-- limit是MySql中的方言</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">分页，每页显示3条</span></span><br><span class="line"><span class="comment">第1页，1，2，3</span></span><br><span class="line"><span class="comment">第2页，4，5，6</span></span><br><span class="line"><span class="comment">第3页，7，8，9</span></span><br><span class="line"><span class="comment">第1页，第1条开始，相对第1条偏移0条，显示3条</span></span><br><span class="line"><span class="comment">第2页，第4条开始，相对第1条偏移3条，显示3条</span></span><br><span class="line"><span class="comment">第3页，第7条开始，相对第1条偏移6条，显示3条</span></span><br><span class="line"><span class="comment">当前页偏移量=当前页之前所有页的显示条数总和</span></span><br><span class="line"><span class="comment">当前页偏移量计算公式：（页数-1）*每页显示条数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="SQL约束"><a href="#SQL约束" class="headerlink" title="SQL约束"></a>SQL约束</h2><p>约束，就是对数据进一步限制，从而保证数据的有效性、正确性、完整性。违反约束的数据将无法插入到数据表中。</p>
<p>约束是针对字段的。</p>
<p>常见约束：</p>
<ul>
<li>主键（primary key）</li>
<li>唯一（unique）</li>
<li>非空（not null）</li>
<li>外键（foreign key）</li>
<li>默认值（default）</li>
</ul>
<h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><p>作用：用来唯一标识数据表中的每一条记录。</p>
<p>特点：不可重复，唯一，非空。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 primary key</span><br><span class="line">primary key(字段名)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">1</span> 创建一个带主键的表 </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp2(eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY, ename <span class="type">VARCHAR</span>(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span> 创建一个带主键的表 </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp2(eid <span class="type">INT</span>, ename <span class="type">VARCHAR</span>(<span class="number">20</span>), <span class="keyword">PRIMARY</span> KEY(eid));</span><br><span class="line"></span><br><span class="line"># 方式<span class="number">3</span> 向已经创建的表添加主键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp2 <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY(eid);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表中的主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp2 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>

<h4 id="主键自增"><a href="#主键自增" class="headerlink" title="主键自增"></a>主键自增</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">关键字:</span><br><span class="line">AUTO_INCREMENT 表示自动增长(字段类型必须是整数类型)</span><br></pre></td></tr></table></figure>

<p>数据库在插入数据时，如果主键自增字段不填写数据，数据库会以自增的形式自动生成主键字段的值。默认从1或者上一条记录的主键字段值开始自增，也可以指定起始值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建主键自增的表 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp2(</span><br><span class="line">  <span class="comment">-- 关键字 AUTO_INCREMENT,主键类型必须是整数类型 </span></span><br><span class="line">  eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  sex <span class="type">CHAR</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建主键自增的表,自定义自增起始值 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp2(</span><br><span class="line">  eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  sex <span class="type">CHAR</span>(<span class="number">1</span>)</span><br><span class="line">)AUTO_INCREMENT<span class="operator">=</span><span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong>delete</strong>删除数据不会影响自增，自增会接着删除前的数据自增。</p>
<p><strong>truncate</strong>删除数据再自增会从1开始，因为truncate是将表删除再复制一个表结构相同的新表。</p>
<h3 id="非空"><a href="#非空" class="headerlink" title="非空"></a>非空</h3><p>特点：该列不允许为null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 not null</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 非空约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp2(</span><br><span class="line">  eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  <span class="comment">-- 添加非空约束, ename字段不能为空 </span></span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  sex <span class="type">CHAR</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>空字符串(‘’)不等于null，可以插入</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 插入<span class="string">&#x27;&#x27;</span>成功</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ename,sex) <span class="keyword">values</span>(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;男&#x27;</span>);	<span class="comment">-- OK, Time: 0.000000s</span></span><br></pre></td></tr></table></figure>

<h3 id="唯一"><a href="#唯一" class="headerlink" title="唯一"></a>唯一</h3><p>特点：该列的值不能重复（对null会忽略不做判断）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段值 unique</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#创建emp3表 为ename 字段添加唯一约束 </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp3(</span><br><span class="line">  eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">  sex <span class="type">CHAR</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>主键约束和唯一约束的区别：</p>
<ul>
<li>主键约束，唯一且不能够为空(主键约束=非空约束+唯一约束)。</li>
<li>唯一约束，唯一 但是可以为空。</li>
<li>一个表中只能有一个主键，但是可以有多个唯一约束。</li>
</ul>
<h3 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h3><p>作用：用来指定该列的默认值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 DEFAULT 默认值</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建带有默认值的表 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp4(</span><br><span class="line">	eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT, </span><br><span class="line">	ename <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  <span class="comment">-- 为sex字段添加默认值</span></span><br><span class="line">	sex <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;女&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加数据 使用默认值</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp4(ename,sex) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三&#x27;</span>,<span class="keyword">DEFAULT</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp4(ename) <span class="keyword">VALUES</span>(<span class="string">&#x27;李四&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>数据表A中某一个字段，指向数据表B中的主键，那么数据表A中的这一字段就是外键。</p>
<p>在这种关系场景中，外键所在的表叫做从表，外键所指向表叫做主表。</p>
<p>作用：使两张数据表产生对应关系。</p>
<p>特点：</p>
<ul>
<li><p>从表插入数据时，外键字段的值必须在主表主键字段中存在，外键字段类型必须和主表主键字段类型保持一致。</p>
</li>
<li><p>一张表可以有多个外键。表明该表与多个表有关联。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 新建表时添加外键</span></span><br><span class="line">[<span class="keyword">CONSTRAINT</span>] [外键约束名称] <span class="keyword">FOREIGN</span> KEY(外键字段名) <span class="keyword">REFERENCES</span> 主表名(主键字段名);</span><br><span class="line"><span class="comment">-- 已有表添加外键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">ADD</span> [<span class="keyword">CONSTRAINT</span>] [外键约束名称] <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主键字段名);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 从表名 <span class="keyword">drop</span> <span class="keyword">foreign</span> key 外键约束名称</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加外键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表 <span class="keyword">ADD</span> [<span class="keyword">CONSTRAINT</span>] [外键约束名称] <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主 键字段名);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加外键约束，创建employee表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee(</span><br><span class="line">  eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="type">INT</span>,</span><br><span class="line">  dept_id <span class="type">INT</span>, <span class="comment">-- 外键字段类型要和主表的主键字段类型保持一致 </span></span><br><span class="line">  <span class="comment">-- 添加外键约束</span></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_dept_fk <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">REFERENCES</span> department(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加数据 (从表外键对应主表主键)</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee (ename, age, dept_id) <span class="keyword">VALUES</span> (<span class="string">&#x27;张百万&#x27;</span>, <span class="number">20</span>, <span class="number">1</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee (ename, age, dept_id) <span class="keyword">VALUES</span> (<span class="string">&#x27;赵四&#x27;</span>, <span class="number">21</span>, <span class="number">1</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee (ename, age, dept_id) <span class="keyword">VALUES</span> (<span class="string">&#x27;广坤&#x27;</span>, <span class="number">20</span>, <span class="number">2</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee (ename, age, dept_id) <span class="keyword">VALUES</span> (<span class="string">&#x27;小斌&#x27;</span>, <span class="number">20</span>, <span class="number">2</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入一条有问题的数据 (部门id在主表主键中不存在)</span></span><br><span class="line"><span class="comment">-- Cannot add or update a child row: a foreign key constraint fails </span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee (ename, age, dept_id) <span class="keyword">VALUES</span> (<span class="string">&#x27;错误&#x27;</span>, <span class="number">18</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除employee 表中的外键约束,外键约束名 emp_dept_fk </span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY emp_dept_fk;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以省略外键名称, 系统会自动生成一个</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY (dept_id) <span class="keyword">REFERENCES</span> department (id);</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<ul>
<li>添加数据时, 应该先添加主表中的数据。</li>
<li>删除数据时,应该先删除从表中的数据。</li>
<li>从表外键类型必须与主表主键类型一致 否则创建失败。</li>
</ul>
<h4 id="级联删除"><a href="#级联删除" class="headerlink" title="级联删除"></a>级联删除</h4><p>删除主表数据的同时，自动删除掉从表数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">级联删除</span><br><span class="line">ON DELETE CASCADE</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 重新创建添加级联操作 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee(</span><br><span class="line">  eid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">  ename <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="type">INT</span>,</span><br><span class="line">  dept_id <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_dept_fk <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">REFERENCES</span> department(id) <span class="comment">-- 添加级联删除</span></span><br><span class="line">  <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>查询多张表(至少涉及2张表),获取到需要的数据。</p>
<h3 id="交叉连接查询"><a href="#交叉连接查询" class="headerlink" title="交叉连接查询"></a>交叉连接查询</h3><p>直接使用select语句查询两张表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段名 FROM 表1, 表2;</span><br></pre></td></tr></table></figure>

<p>交叉连接查询会产生笛卡尔积，查询结果有误</p>
<h4 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h4><p><img src="https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-05_19-44-43.jpg" alt="img"></p>
<h3 id="内连接查询"><a href="#内连接查询" class="headerlink" title="内连接查询"></a>内连接查询</h3><h4 id="隐式内连接"><a href="#隐式内连接" class="headerlink" title="隐式内连接"></a>隐式内连接</h4><p>交叉连接查询+where条件过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段名 FROM 左表, 右表 WHERE 连接条件;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 隐式内连接</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products,category <span class="keyword">WHERE</span> category_id <span class="operator">=</span> cid;</span><br><span class="line"></span><br><span class="line">#查询 格力空调是属于哪一分类下的商品</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">p.pname, c.cname</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">products p , category c </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">p.category_id <span class="operator">=</span> c.cid </span><br><span class="line"><span class="keyword">AND</span> p.pname <span class="operator">=</span> <span class="string">&#x27;格力空调&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="显示内连接"><a href="#显示内连接" class="headerlink" title="显示内连接"></a>显示内连接</h4><p>使用**[inner] join … on …关键字**。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段名 FROM 左表 [INNER] JOIN 右表 ON 条件 [and 条件2] [where 条件 [and 条件2]] -- inner 可以省略</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 显式内连接查询</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products p <span class="keyword">INNER</span> <span class="keyword">JOIN</span> category c <span class="keyword">ON</span> p.category_id <span class="operator">=</span> c.cid;</span><br><span class="line"></span><br><span class="line"># 查询鞋服分类下,价格大于<span class="number">500</span>的商品名称和价格</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">p.pname,p.price</span><br><span class="line"><span class="keyword">FROM</span> products p <span class="keyword">INNER</span> <span class="keyword">JOIN</span> category c </span><br><span class="line"><span class="keyword">ON</span> p.category_id <span class="operator">=</span> c.cid </span><br><span class="line"><span class="keyword">WHERE</span> p.price <span class="operator">&gt;</span> <span class="number">500</span> <span class="keyword">AND</span> cname <span class="operator">=</span> <span class="string">&#x27;鞋服&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="外连接查询"><a href="#外连接查询" class="headerlink" title="外连接查询"></a>外连接查询</h3><h4 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h4><p>使用left [outer] join … on …关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段名 FROM 左表 LEFT [OUTER] JOIN 右表 ON 条件 [and 条件2] [where 条件 [and 条件2]]</span><br></pre></td></tr></table></figure>

<p>特点：</p>
<ul>
<li>左表为基准, 右表去查询左表</li>
<li>返回结果时，左表数据正常展示，右表在左表中查询得到的数据正常展示，查询不到的展示为Null</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 左外连接查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> category c <span class="keyword">left</span> <span class="keyword">join</span> products p <span class="keyword">on</span> c.cid <span class="operator">=</span> p.category_id;</span><br><span class="line"></span><br><span class="line"># 分类表中有汽车类目，商品表中并并没有该类目的商品</span><br><span class="line">c001	家电	p001	小 米 电 视 机 	<span class="number">5000</span>	<span class="number">1</span>	c001</span><br><span class="line">c001	家电	p002	格 力 空 调 	<span class="number">3000</span>	<span class="number">1</span>	c001</span><br><span class="line">c001	家电	p003	美 的 冰 箱 	<span class="number">4500</span>	<span class="number">1</span>	c001</span><br><span class="line">c002	鞋服	p004	篮 球 鞋 	<span class="number">800</span>	<span class="number">1</span>	c002</span><br><span class="line">c002	鞋服	p005	运 动 裤 	<span class="number">200</span>	<span class="number">1</span>	c002</span><br><span class="line">c002	鞋服	p006	T 恤 	<span class="number">300</span>	<span class="number">1</span>	c002</span><br><span class="line">c002	鞋服	p007	冲 锋 衣 	<span class="number">2000</span>	<span class="number">1</span>	c002</span><br><span class="line">c003	化妆品	p008	神 仙 水 	<span class="number">800</span>	<span class="number">1</span>	c003</span><br><span class="line">c003	化妆品	p009	大 宝 	<span class="number">200</span>	<span class="number">1</span>	c003</span><br><span class="line">c004	汽车	</span><br><span class="line"></span><br><span class="line"># 查询每个分类下的商品个数</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">c.cname, <span class="built_in">count</span>(p.pid) </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">category c <span class="keyword">left</span> <span class="keyword">join</span> products p </span><br><span class="line"><span class="keyword">on</span> c.cid <span class="operator">=</span> p.category_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.cname;</span><br></pre></td></tr></table></figure>

<h4 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h4><p>使用 right [outer] join … on … 关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段名 FROM 左表 RIGHT [OUTER] JOIN 右表 ON 条件 [and 条件2] [where 条件 [and 条件2]]</span><br></pre></td></tr></table></figure>

<p>特点：和左外连接一样，只是以右表为基准。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><img src="https://gitee.com/ethan-H/imghost/raw/master/blog/Xnip2021-05-05_21-50-07.jpg" alt="img"></p>
<p>2个以上表如何多表查询，思路是先选2个进行查询，将查询结果当作一个新的表，再和下一个表进行多表查询，以此类推。</p>
<h3 id="join-on-and-和-join-on-where-and"><a href="#join-on-and-和-join-on-where-and" class="headerlink" title="join on and 和 join on where and"></a>join on and 和 join on where and</h3><p>在使用left join时，on和where条件的区别如下：  </p>
<p>1、on条件是在生成临时表时使用的条件，它不管on中的条件是否为真，都会返回左边表中的记录。（实际上左连接中如果and语句是对左表进行过滤的，那么不管真假都不起任何作用。如果是对右表过滤的，那么左表所有记录都返回，右表筛选以后再与左表连接返回） </p>
<p>2、where条件是在临时表生成好后，再对临时表进行过滤的条件。这时已经没有left join的含义（必须返回左边表的记录）了，条件不为真的就全部过滤掉，on后的条件用来生成左右表关联的临时表，where后的条件对临时表中的记录进行过滤。</p>
<p> 在使用inner join时，不管是对左表还是右表进行筛选，on and和on where都会对生成的临时表进行过滤。</p>
<p>————————————————<br>版权声明：本文为CSDN博主「行者摩罗」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xingzhemoluo/article/details/39677891">https://blog.csdn.net/xingzhemoluo/article/details/39677891</a></p>
<h2 id="合并查询"><a href="#合并查询" class="headerlink" title="合并查询"></a>合并查询</h2><p>union和union all</p>
<p>union/union all操作符用来合并多个select语句的结果集（就是查询结果）。</p>
<p>union 和 union all 都要满足以下条件才能合并：</p>
<ul>
<li>要合并的结果集，列数必须相同，列的顺序必须一致，列的字段类型也必须相似。</li>
</ul>
<p>union 和 union all 的区别：</p>
<ul>
<li>union：消除重复行，重复检查期间，null值会被算在内。</li>
<li>union all：不消除重复行，只是将结果集合并后就返回。</li>
<li>执行效率上，union all 要比 union 快很多。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1 [, column2 ]</span><br><span class="line"><span class="keyword">FROM</span> table1 [, table2 ]</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line"><span class="keyword">UNION</span> <span class="operator">/</span> <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> column1 [, column2 ]</span><br><span class="line"><span class="keyword">FROM</span> table1 [, table2 ]</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>子查询概念：一条select 查询语句的结果, 作为另一条 select 语句的一部分。</p>
<p>特点：</p>
<ul>
<li>子查询必须放在小括号中</li>
<li>整个sql至少会有两个select关键字</li>
</ul>
<p>子查询常见分类</p>
<ul>
<li><strong>where型子查询</strong>：将子查询的结果, 作为父查询的比较条件</li>
<li>**from型子查询 **：将子查询的结果, 作为 一张表,提供给父层查询使用</li>
<li><strong>exists型子查询</strong>：子查询的结果是单列多行, 类似一个数组, 父层查询使用 IN 函数 ,包含子查询的结果</li>
</ul>
<h3 id="where型子查询"><a href="#where型子查询" class="headerlink" title="where型子查询"></a>where型子查询</h3><p>当子查询的结果是一个值时（单行单列）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询字段 FROM 表 WHERE 字段 &#x3D; (子查询);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 子查询的方式, 查询价格最高的商品信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> products <span class="keyword">where</span> price <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">max</span>(price) <span class="keyword">from</span> products);</span><br><span class="line"></span><br><span class="line"># 查询化妆品分类下的 商品名称 商品价格</span><br><span class="line"><span class="comment">-- 子查询</span></span><br><span class="line"><span class="keyword">select</span> p.pname, p.price <span class="keyword">from</span> products p <span class="keyword">where</span> p.category_id <span class="operator">=</span> (<span class="keyword">select</span> cid <span class="keyword">from</span> category <span class="keyword">where</span> cname <span class="operator">=</span> <span class="string">&#x27;化妆品&#x27;</span>);</span><br><span class="line"><span class="comment">-- 内连接查询</span></span><br><span class="line"><span class="keyword">select</span>  p.pname,p.price <span class="keyword">from</span> products p <span class="keyword">join</span> category c <span class="keyword">on</span> p.category_id <span class="operator">=</span> c.cid <span class="keyword">where</span> c.cname <span class="operator">=</span> <span class="string">&#x27;化妆品&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="exists型子查询"><a href="#exists型子查询" class="headerlink" title="exists型子查询"></a>exists型子查询</h3><p>当子查询的结果是一个集合时（多行单列），需要用where … in (子查询)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询字段 FROM 表 WHERE 字段 in (子查询);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询价格小于两千的商品,来自于哪些分类(名称)</span><br><span class="line"><span class="keyword">select</span> cname <span class="keyword">from</span> category <span class="keyword">where</span> cid <span class="keyword">in</span> (<span class="keyword">select</span> category_id <span class="keyword">from</span> products <span class="keyword">where</span> price <span class="operator">&lt;</span> <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"># 查询家电类 与 鞋服类下面的全部商品信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> products <span class="keyword">where</span> category_id <span class="keyword">in</span> (<span class="keyword">select</span> cid <span class="keyword">from</span> category <span class="keyword">where</span> cname <span class="keyword">in</span>(<span class="string">&#x27;家电&#x27;</span>,<span class="string">&#x27;鞋服&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="from型子查询"><a href="#from型子查询" class="headerlink" title="from型子查询"></a>from型子查询</h3><p>当子查询的结果是一个表（多列多行）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 查询字段 FROM (子查询)表别名 WHERE 条件;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询商品中,价格大于<span class="number">500</span>的商品信息,包括 商品名称 商品价格 商品所属分类名称</span><br><span class="line"><span class="comment">-- 子查询</span></span><br><span class="line"><span class="keyword">select</span> p.pname,p.price,c.cname <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> products <span class="keyword">where</span> price <span class="operator">&gt;</span> <span class="number">500</span>) p <span class="keyword">join</span> category c <span class="keyword">on</span> p.category_id <span class="operator">=</span> c.cid;</span><br><span class="line"><span class="comment">-- 内连接查询</span></span><br><span class="line"><span class="keyword">select</span> p.pname,p.price,c.cname <span class="keyword">from</span> products p  <span class="keyword">join</span> category c <span class="keyword">on</span> p.category_id <span class="operator">=</span> c.cid <span class="keyword">where</span> p.price <span class="operator">&gt;</span> <span class="number">500</span>;</span><br></pre></td></tr></table></figure>

<p><strong>当子查询作为一张表的时候，需要起别名，否则无法访问表中的字段。</strong></p>
<h1 id="SQL语句执行顺序"><a href="#SQL语句执行顺序" class="headerlink" title="SQL语句执行顺序"></a>SQL语句执行顺序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. from </span><br><span class="line">2. join </span><br><span class="line">3. on </span><br><span class="line">4. where </span><br><span class="line">5. group by(开始使用select中的别名，后面的语句中都可以使用)</span><br><span class="line">6.  avg,sum.... </span><br><span class="line">7. having </span><br><span class="line">8. select </span><br><span class="line">9. distinct </span><br><span class="line">10. order by</span><br><span class="line">11. limit </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1、FROM  table1 left join table2 on 将table1和table2中的数据产生笛卡尔积，生成Temp1</span><br><span class="line"></span><br><span class="line">2、JOIN table2  所以先是确定表，再确定关联条件</span><br><span class="line"></span><br><span class="line">3、ON table1.column &#x3D; table2.columu 确定表的绑定条件 由Temp1产生中间表Temp2</span><br><span class="line"></span><br><span class="line">4、WHERE  对中间表Temp2产生的结果进行过滤  产生中间表Temp3</span><br><span class="line"></span><br><span class="line">5、GROUP BY 对中间表Temp3进行分组，产生中间表Temp4</span><br><span class="line"></span><br><span class="line">6、HAVING  对分组后的记录进行聚合 产生中间表Temp5</span><br><span class="line"></span><br><span class="line">7、SELECT  对中间表Temp5进行列筛选，产生中间表 Temp6</span><br><span class="line"></span><br><span class="line">8、DISTINCT 对中间表 Temp6进行去重，产生中间表 Temp7</span><br><span class="line"></span><br><span class="line">9、ORDER BY 对Temp7中的数据进行排序，产生中间表Temp8</span><br><span class="line"></span><br><span class="line">10、LIMIT 对中间表Temp8进行分页，产生中间表Temp9</span><br></pre></td></tr></table></figure>

<h1 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询线索(二级渠道jdsc)后续转化成交车型详情。</span><br><span class="line"><span class="comment">-- 在二级渠道jdsc下，成交的线索，的车型详情</span></span><br><span class="line"><span class="comment">-- 线索表中二级渠道下的线索 和 订单表中的线索 的 交集。所以使用内连接查询。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> clue_day c, order_day o <span class="keyword">where</span> c.clue_id <span class="operator">=</span> o.clue_id <span class="keyword">and</span> c.ca_n <span class="operator">=</span> <span class="string">&#x27;jdsc&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> clue_day c <span class="keyword">join</span> order_day o <span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id <span class="keyword">where</span> c.ca_n <span class="operator">=</span> <span class="string">&#x27;jdsc&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 统计所有渠道(按照二级渠道)的转化率</span><br><span class="line"><span class="comment">-- 转化率 = 该渠道下订单数/该渠道下线索数。订单数是线索数的子集，所以使用外连接查询。</span></span><br><span class="line"><span class="comment">-- 统计每一个二级渠道的转化率：按二级渠道分组聚合统计</span></span><br><span class="line"><span class="keyword">select</span> c.ca_n, <span class="built_in">count</span>(o.order_id)<span class="operator">/</span><span class="built_in">count</span>(c.clue_id) </span><br><span class="line"><span class="keyword">from</span> clue_day c <span class="keyword">left</span> <span class="keyword">join</span> order_day o </span><br><span class="line"><span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.ca_n;</span><br></pre></td></tr></table></figure>

<h1 id="案例3"><a href="#案例3" class="headerlink" title="案例3"></a>案例3</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 查询各城市线索数并计算所有城市线索总数</span><br><span class="line"><span class="comment">-- 各城市线索数只需要用到clue表一张表，因此不需要多表查询</span></span><br><span class="line"><span class="comment">-- 各城市线索数，需要按城市分组求和</span></span><br><span class="line"><span class="comment">-- 各城市线索数，加起来就是所有城市线索总数，因此是子查询❌</span></span><br><span class="line"><span class="comment">-- 错误原因：子查询无法将两个结果展示在一张表中</span></span><br><span class="line"><span class="comment">-- 使用合并查询，将两个结果拼在一张表中。</span></span><br><span class="line"><span class="comment">-- 所有城市线索总数，也不需要先计算各城市线索数再求和，直接对clue表的线索求和即可。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> c.city_id,<span class="built_in">count</span>(c.clue_id)clue_num <span class="keyword">from</span> clue_day c <span class="keyword">group</span> <span class="keyword">by</span> c.city_id</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;总计&#x27;</span>,<span class="built_in">count</span>(c.clue_id) <span class="keyword">from</span> clue_day c;</span><br></pre></td></tr></table></figure>

<h1 id="案例4"><a href="#案例4" class="headerlink" title="案例4"></a>案例4</h1><p>日期直接相减做了一个隐式转换操作，将时间转换为整数，但并不是用unix_timestamp转换，而是直接把年月日时分秒拼起来，如2013-04-21 16:59:33 直接转换为20130421165933，所以得到的结果是错误的。</p>
<p>Unix_timestamp([日期])函数：返回自’1970-01-01 00:00:00’的到当前日期[指定日期]的秒数差。</p>
<p>Datediff(d1,d2)函数：返回d1-d2的天数差</p>
<p>Ceil()函数：向上取整</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 找出优质渠道，做重点投入</span></span><br><span class="line"><span class="comment">-- 我们对于优质渠道(以二级渠道来说)的定义: </span></span><br><span class="line"><span class="comment">-- 该二级渠道内平均转化周期&lt; 整体平均转化周期</span></span><br><span class="line"><span class="comment">-- 该二级渠道的线索量 &gt; 各二级渠道平均线索量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	针对《二级渠道内平均转化周期》和《二级渠道的线索量》的分析</span></span><br><span class="line"><span class="comment">	转化周期:成单日期 — 线索创建日期 平均:avg</span></span><br><span class="line"><span class="comment">	渠道线索量:分组 count统计</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">-- 这里需要注意：二级渠道线索量是所有二级渠道的，其中包括未成单的二级渠道。</span></span><br><span class="line"><span class="comment">-- 因此这里使用关联查询时，首先排除内连接，因为内连接只能查出成单的二级渠道</span></span><br><span class="line"><span class="comment">-- 其次使用外连接时，clue表应该作为主表将渠道全部展示出来</span></span><br><span class="line"><span class="keyword">select</span> ca_n, <span class="built_in">avg</span>(datediff(created_at,clue_created_at)), <span class="built_in">count</span>(c.clue_id) </span><br><span class="line"><span class="keyword">from</span> clue_day c <span class="keyword">left</span> <span class="keyword">join</span> order_day o <span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id</span><br><span class="line"><span class="keyword">where</span> created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> clue_created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ca_n</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 二级渠道平均线索量</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">ceil</span>(<span class="built_in">avg</span>(clue_num)) <span class="keyword">from</span> (</span><br><span class="line">  <span class="keyword">select</span> ca_n, <span class="built_in">avg</span>(datediff(created_at,clue_created_at)), <span class="built_in">count</span>(c.clue_id) </span><br><span class="line">  <span class="keyword">from</span> clue_day c <span class="keyword">left</span> <span class="keyword">join</span> order_day o 	<span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id</span><br><span class="line">  <span class="keyword">where</span> created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> clue_created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> ca_n</span><br><span class="line">)a <span class="comment">-- 子查询作为一张表时，必须有别名才能访问其中的字段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 整体平均转化周期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">avg</span>(datediff( created_at, clue_created_at )) </span><br><span class="line"><span class="keyword">FROM</span> clue_day c <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> order_day o <span class="keyword">ON</span> c.clue_id <span class="operator">=</span> o.clue_id </span><br><span class="line"><span class="keyword">WHERE</span> created_at <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> clue_created_at <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询结果</span></span><br><span class="line"><span class="keyword">select</span> ca_n, avg_time, clue_num <span class="keyword">from</span> (</span><br><span class="line">  <span class="comment">-- 《二级渠道内平均转化周期》和《二级渠道的线索量》</span></span><br><span class="line">  <span class="keyword">select</span> ca_n, <span class="built_in">avg</span>(datediff(created_at,clue_created_at)), <span class="built_in">count</span>(c.clue_id) </span><br><span class="line">  <span class="keyword">from</span> clue_day c <span class="keyword">left</span> <span class="keyword">join</span> order_day o <span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id</span><br><span class="line">  <span class="keyword">where</span> created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> clue_created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> ca_n</span><br><span class="line">)</span><br><span class="line"><span class="keyword">WHERE</span> avg_time <span class="operator">&lt;</span> (</span><br><span class="line">  <span class="comment">-- 整体平均转化周期</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">avg</span>(datediff( created_at, clue_created_at )) </span><br><span class="line">	<span class="keyword">FROM</span> clue_day c <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> order_day o <span class="keyword">ON</span> c.clue_id <span class="operator">=</span> o.clue_id </span><br><span class="line">	<span class="keyword">WHERE</span> created_at <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> clue_created_at <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> </span><br><span class="line">	) </span><br><span class="line"><span class="keyword">AND</span> clue_num <span class="operator">&gt;</span> (</span><br><span class="line">  <span class="comment">-- 二级渠道平均线索量</span></span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">ceil</span>(<span class="built_in">avg</span>(clue_num)) <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> ca_n, <span class="built_in">avg</span>(datediff(created_at,clue_created_at)), <span class="built_in">count</span>(c.clue_id) </span><br><span class="line">    <span class="keyword">from</span> clue_day c <span class="keyword">left</span> <span class="keyword">join</span> order_day o 	<span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id</span><br><span class="line">    <span class="keyword">where</span> created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> clue_created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">NULL</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> ca_n</span><br><span class="line">	)a </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>一段sql查询多次作为子查询被使用，可以用with 别名 as (子查询) 优化：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 《二级渠道内平均转化周期》和《二级渠道的线索量》</span></span><br><span class="line"><span class="keyword">with</span> ca_value <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> ca_n, <span class="built_in">avg</span>(datediff(created_at,clue_created_at)), <span class="built_in">count</span>(c.clue_id) </span><br><span class="line">  <span class="keyword">from</span> clue_day c <span class="keyword">left</span> <span class="keyword">join</span> order_day o <span class="keyword">on</span> c.clue_id <span class="operator">=</span> o.clue_id</span><br><span class="line">  <span class="keyword">where</span> created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> clue_created_at <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> ca_n</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 查询结果</span></span><br><span class="line"><span class="keyword">select</span> ca_n, avg_time, clue_num <span class="keyword">from</span> ca_value</span><br><span class="line"><span class="keyword">WHERE</span> avg_time <span class="operator">&lt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">avg</span>(datediff( created_at, clue_created_at )) </span><br><span class="line">	<span class="keyword">FROM</span> clue_day c <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> order_day o <span class="keyword">ON</span> c.clue_id <span class="operator">=</span> o.clue_id </span><br><span class="line">	<span class="keyword">WHERE</span> created_at <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> clue_created_at <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> </span><br><span class="line">	) </span><br><span class="line"><span class="keyword">AND</span> clue_num <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">ceil</span>(<span class="built_in">avg</span>( clue_num )) <span class="keyword">FROM</span> ca_value);</span><br></pre></td></tr></table></figure>

<p><strong>⚠️注意</strong>：<a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/390280176">with…as…的用法</a></p>
<h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span></span><br><span class="line"> <span class="keyword">when</span> 条件<span class="number">1</span> <span class="keyword">then</span> 结果<span class="number">1</span></span><br><span class="line"> <span class="keyword">when</span> 条件<span class="number">2</span> <span class="keyword">then</span> 结果<span class="number">2</span></span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">else</span> 结果（默认<span class="keyword">null</span>） <span class="comment">-- 上面条件都不满足时，返回else结果；如果不写else，默认也返回null</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 使用<span class="keyword">DELETE</span> <span class="keyword">JOIN</span>语句删除重复的行</span><br><span class="line"># 以下语句删除重复行并保留最高ID：</span><br><span class="line"><span class="keyword">DELETE</span> t1 <span class="keyword">FROM</span> contacts_test t1</span><br><span class="line">        <span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">    contacts_test t2 </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    t1.id <span class="operator">&lt;</span> t2.id <span class="keyword">AND</span> t1.email <span class="operator">=</span> t2.email;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" rel="tag"># 数据分析</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/20210429171201/" rel="prev" title="【数据分析】第一阶段：数据分析思维与业务流程">
                  <i class="fa fa-chevron-left"></i> 【数据分析】第一阶段：数据分析思维与业务流程
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/20210507225731/" rel="next" title="统计学笔记">
                  统计学笔记 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">昱森</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
